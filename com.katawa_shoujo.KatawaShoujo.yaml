app-id: com.katawa_shoujo.KatawaShoujo
runtime: org.freedesktop.Platform
runtime-version: "22.08"
sdk: org.freedesktop.Sdk
command: "KatawaShoujo"
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --persist=.renpy
modules:
  - name: KatawaShoujo
    buildsystem: simple
    build-commands:
      - mkdir -p /app/game
      - cp -R KatawaShoujo.py KatawaShoujo.sh game lib renpy "${FLATPAK_DEST}/game"
      - install -Dm755 launcher.sh "${FLATPAK_DEST}/bin/KatawaShoujo"
      - install -Dm644 -t "${FLATPAK_DEST}/share/appdata/" com.katawa_shoujo.KatawaShoujo.appdata.xml
      - install -Dm644 -t "${FLATPAK_DEST}/share/applications/" com.katawa_shoujo.KatawaShoujo.desktop
      - install -Dm644 icon512x512.png "${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png"
    sources:
      - type: archive
        url: https://github.com/gcammisa/KatawaShoujo-RenPy8/releases/download/8.0.3/katawashoujo-linux.tar.bz2
        sha256: c4719b80c6a51f4a0b7a491b5a272f4a1c7a154f52bcda21b0684d5010f7a479
      - type: script
        dest-filename: launcher.sh
        commands:
          - /app/game/KatawaShoujo.sh "$@"
      - type: file
        path: com.katawa_shoujo.KatawaShoujo.appdata.xml
      - type: file
        path: com.katawa_shoujo.KatawaShoujo.desktop
      - type: file
        path: icon512x512.png
